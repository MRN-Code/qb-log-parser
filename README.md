qb-log-parser
-------------

This repo contains a program to parse the log files generated by query builder. By changing the `config/default` file, it is possible to filter the logs by username.

#Usage

1. modify `config/default.json` to reflect the location of the log files to be read.
2. run `node index.js` to parse the files.
3. output will be stored in `temp/queries.csv`

#Discussion

As of this writing, there is a bug in QB that results in unreliable timestamps in the QB logs.
Specifically, the value for `minutes` is actually the current month, due to a typo in the date format (`Ymd H:m:s`).
This makes it impossible to know which subject insertion query preceeded a preview query if there were more than one subject insertion query in the same hour as the preview query.

To get around the above bug, preview queries are associated with subject insertion queries on the following grounds:

1. The last subject insertion query logged anytime *before the hour* in which the preview query was run.
2. All subject insertion queries for the hour in which the preview query was run.

Subject insertion queries matching the above criteria are then filtered, so that they represent unique lists of URSIs.
This  means that if there are four subject insertion queries within an hour, but they all are inserting the exact same URSIs, they will be reduced to one row in the output.

This bug will likely be fixed in the near future, and so such complex logic will no longer be necessary.

